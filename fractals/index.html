<!DOCTYPE html>
<meta name="viewport" content="width=480,user-scalable=no" />
<html>
    <head>
        <title>Fractals using Probability</title>
    </head>
    <body>
        <div class="title-box">
            <h1>"Chaos Game"</h1>
            <h2>Generate beautiful patterns with simple probability.</h2>
        </div>
        <div class="options-box">
            Number of Vertices:
            <input id="numVertices" type="number" value="3" style="width: 5em; margin-right: 1em;" placeholder="Number of Vertices">
            Midpoint Ratio:
            <input id="midDist" type="number" value="2" style="width: 5em; margin-right: 1em;" placeholder="Midpoint Distance">
            Framerate:
            <input id="framerate" type="number" value="1000" style="width: 5em; margin-right: 1em;" placeholder="Framerate">
            <button id="refreshBtn" style="width:5em; margin-left: 1em;">Refresh</button>
        </div>
        <div class="canvas-box">
            <canvas id="myCanvas" width="750" height="750"></canvas>
        </div>
    </body>
    <script>
        // Javascript for probability fractal generator
        // Author: Noah Synowiec
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        // Fullscreen
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight*4/5;
        var width = canvas.width;
        var height = canvas.height;
        var numCorners = parseInt(document.getElementById("numVertices").value);
        var midDist = parseInt(document.getElementById("midDist").value);
        var frameRate = 1/parseInt(document.getElementById("framerate").value);;

        //var tri = [[width/2,       height/6],
        //           [width/18,      (height/6)*5],
        //          [(width/18)*17, (height/6)*5]]
        var tri = []
        var tracePoint = [];

        document.addEventListener("mouseup", mouseUpHandler);
        document.getElementById("refreshBtn").addEventListener("click", refresh);
        var drawInt = setInterval(draw, frameRate);
        draw();

        function refresh() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight*4/5;
            width = canvas.width;
            height = canvas.height;
            numCorners = parseInt(document.getElementById("numVertices").value);
            midDist = parseInt(document.getElementById("midDist").value);
            frameRate = 1/parseInt(document.getElementById("framerate").value);
            tri = []
            tracePoint = [];
            //clearInterval(drawInt);
            //drawInt = 0;
            //drawInt = setInterval(draw, frameRate);
            //draw();
        }

        function draw() {
            if (tri.length == numCorners && tracePoint.length == 2) {
                drawPoint(tracePoint[0], tracePoint[1]);
                var corner = chooseCorner(numCorners);
                tracePoint = getMidpoint(tri[corner][0], tri[corner][1],
                                        tracePoint[0] , tracePoint[1])
            }
        }

        function mouseUpHandler(e) {
            if (tri.length < numCorners) {
                drawPoint(e.offsetX, e.offsetY, 2)
                tri.push([e.offsetX, e.offsetY])
            } else if (tracePoint.length == 0) {
                tracePoint = [e.offsetX, e.offsetY]
            }
        }

        function mouseInBounds(e) {

        }

        function getMidpoint(x1, y1, x2, y2) {
            return [x2+((x1-x2)/midDist), y2+((y1-y2)/midDist)]
        }

        function chooseCorner(numCorners) {
            return Math.floor(Math.random()*numCorners)
        }

        function drawPoint(x, y, r=1) {
            ctx.beginPath();
            ctx.rect(x, y, r, r);
            ctx.fillStyle = "white";
            ctx.fill();
            ctx.closePath();
        }
    </script>
    <style>
        * { 
            padding: 0; 
            margin: 0; 
        }
        canvas { 
            background: black; 
            display: block; 
            margin: 0 auto; 
        }
        .title-box {
            width: 100vw;
            height: 10vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            place-content: center;
        }
        .options-box {
            width: 100vw;
            height: 10vh;
            display: flex;
            flex-direction: row;
            align-items: center;
            place-content: center;
        }
        .canvas-box {
            width: 100vw;
            height: 80vh;
            overflow: hidden;
            display: grid;
            place-content: center;
        }
    </style>
</html>